# ğŸ¤– Aè‚¡çŸ­çº¿äº¤æ˜“ç³»ç»Ÿ - LLM Agent ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

**LLM Agent** æ˜¯ç³»ç»Ÿçš„è‡ªç„¶è¯­è¨€äº¤äº’ç•Œé¢ï¼Œä½¿ç”¨ **GPT-3.5/GPT-4** ä½œä¸ºå¤§æ¨¡å‹å¼•æ“ï¼Œæ”¯æŒä¸­æ–‡å¯¹è¯ã€‚ä½ å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€è¯¢é—®å¸‚åœºçŠ¶æ€ã€è·å–äº¤æ˜“ä¿¡å·ã€æŸ¥çœ‹å‚æ•°ç­‰ã€‚

```
ç”¨æˆ· (è‡ªç„¶è¯­è¨€) 
    â†“
Agent (ç†è§£æ„å›¾)
    â†“
å·¥å…·è·¯ç”±å™¨ (é€‰æ‹©åˆé€‚çš„å·¥å…·)
    â†“
ç³»ç»Ÿå·¥å…· (æŸ¥è¯¢å¸‚åœºã€ç”Ÿæˆè®¢å•ç­‰)
    â†“
ç»“æœæ±‡æ€» (è‡ªç„¶è¯­è¨€è¿”å›)
    â†“
ç”¨æˆ· (è·å¾—ç­”æ¡ˆ)
```

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
cd /home/deeproute/zj/cg/a-share-agent

# å®‰è£… LangChain å’Œ OpenAI
pip install langchain>=0.1.0 openai>=1.0.0 python-dotenv -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2ï¸âƒ£ è·å– OpenAI API Key

è®¿é—® https://platform.openai.com/api-keys è·å–ä½ çš„ API Key

**è´¹ç”¨ä¼°ç®—**:
- GPT-3.5-turbo: ~$0.0015 æ¯1000 tokens (è¶…ä¾¿å®œ)
- GPT-4: ~$0.03 æ¯1000 tokens (æ›´èªæ˜ä½†è´µ)
- **å»ºè®®**: ç”¨ GPT-3.5-turboï¼Œ$5 å°±èƒ½ç”¨å¾ˆä¹…

### 3ï¸âƒ£ é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶æ¨¡æ¿æ–‡ä»¶ï¼š
```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Keyï¼š
```
OPENAI_API_KEY=sk-xxx...
```

### 4ï¸âƒ£ è¿è¡Œ Agent

```bash
python3 scripts/run_agent.py
```

ä½ ä¼šçœ‹åˆ°äº¤äº’ç•Œé¢ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¤– Aè‚¡çŸ­çº¿äº¤æ˜“ç³»ç»Ÿ - AI Agent å·²å¯åŠ¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’¡ è¾“å…¥ 'help' æŸ¥çœ‹å¸®åŠ©ï¼Œ'quit' é€€å‡º

ğŸ§‘ ä½ : 
```

---

## ğŸ’¬ å¯¹è¯ç¤ºä¾‹

### ç¤ºä¾‹ 1: æŸ¥è¯¢å¸‚åœºçŠ¶æ€

```
ğŸ§‘ ä½ : ç°åœ¨å¸‚åœºæ€ä¹ˆæ ·ï¼Ÿ

ğŸ¤– Agent æ€è€ƒä¸­...

âœ¨ Agent: 
ğŸ“Š å¸‚åœºå®½åº¦åˆ†æ (æˆªæ­¢ 2025-11-01)
â”œâ”€ å¸‚åœºæ€åŠ¿: Neutral ğŸŸ¡
â”œâ”€ å®½åº¦å¾—åˆ†: 0.234
â”œâ”€ ä¸Šæ¶¨å®¶æ•°: 2156 å®¶
â”œâ”€ ä¸‹è·Œå®¶æ•°: 1950 å®¶
â”œâ”€ ä¸Šå‡æ¯”ä¾‹: 51.25%
â””â”€ æ¨èä»“ä½: 75.73%

è§£è¯»:
âš ï¸ å¸‚åœºä¸­æ€§ï¼Œè°¨æ…å…¥åœº
```

### ç¤ºä¾‹ 2: æŸ¥çœ‹ä»Šæ—¥è®¢å•

```
ğŸ§‘ ä½ : ä»Šå¤©æœ‰ä»€ä¹ˆè‚¡ç¥¨å¯ä»¥ä¹°ï¼Ÿ

ğŸ¤– Agent æ€è€ƒä¸­...

âœ¨ Agent:
ğŸ“‹ ä»Šæ—¥äº¤æ˜“è®¢å• (5 ä¸ªæ ‡çš„)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. 000858_SZ | æ’å: 12/100 | æ‰“åˆ†: 2.156 | æƒé‡: 20.00%
2. 000651_SZ | æ’å: 45/100 | æ‰“åˆ†: 1.834 | æƒé‡: 20.00%
3. 600000_SH | æ’å: 23/100 | æ‰“åˆ†: 2.012 | æƒé‡: 20.00%
4. 002594_SZ | æ’å: 67/100 | æ‰“åˆ†: 1.567 | æƒé‡: 20.00%
5. 600276_SH | æ’å: 89/100 | æ‰“åˆ†: 1.234 | æƒé‡: 20.00%
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ€»æŠ•èµ„æ¯”ä¾‹: 100.00%
```

### ç¤ºä¾‹ 3: ç³»ç»Ÿæ›´æ–°

```
ğŸ§‘ ä½ : è¿è¡Œç³»ç»Ÿæ›´æ–°

ğŸ¤– Agent æ€è€ƒä¸­...

âœ¨ Agent: âœ… ç³»ç»Ÿæ›´æ–°æˆåŠŸï¼å·²ç”Ÿæˆæœ€æ–°è®¢å•å’Œå¸‚åœºæŒ‡æ ‡
```

### ç¤ºä¾‹ 4: æŸ¥çœ‹å‚æ•°

```
ğŸ§‘ ä½ : ç³»ç»Ÿå‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ

ğŸ¤– Agent æ€è€ƒä¸­...

âœ¨ Agent:
âš™ï¸ ç³»ç»Ÿå‚æ•° (å¯è°ƒæ•´)
â”œâ”€ åŠ¨é‡é˜ˆå€¼: 0.6 (ç™¾åˆ†ä½)
â”œâ”€ æ³¢åŠ¨é˜ˆå€¼: 0.8 (ç™¾åˆ†ä½)  
â”œâ”€ æˆäº¤é‡å€æ•°: 1.0
â”œâ”€ Top-Kä¸ªæ•°: 20
â”œâ”€ æœ€ä½è®°å½•æ•°: 60å¤©
â”œâ”€ å¸‚åœºæ€åŠ¿æƒé‡:
â”‚  â”œâ”€ æ¶¨è·Œæ¯”: 50%
â”‚  â”œâ”€ æ–°é«˜/æ–°ä½: 30%
â”‚  â””â”€ æ¶¨åœæ¯”: 20%
â””â”€ ä»“ä½ç¼©æ”¾: Sigmoid (20%-100% èŒƒå›´)

ğŸ’¡ è°ƒæ•´æ–¹æ³•:
- é™ä½åŠ¨é‡é˜ˆå€¼ â†’ å¢åŠ ä¿¡å·æ•°é‡
- é™ä½æ³¢åŠ¨é˜ˆå€¼ â†’ ç­›é€‰æ›´ç¨³å®šçš„æ ‡çš„
- å¢åŠ Top-K â†’ æ›´æ¿€è¿›çš„é€‰æ‹©
```

---

## ğŸ› ï¸ å¯ç”¨å·¥å…·åˆ—è¡¨

Agent å¯ä»¥è°ƒç”¨ä»¥ä¸‹ 6 ä¸ªå·¥å…·ï¼š

| å·¥å…· | åŠŸèƒ½ | è§¦å‘å…³é”®è¯ |
|-----|------|---------|
| `query_market_breadth` | æŸ¥è¯¢å¸‚åœºå®½åº¦å’Œæ€åŠ¿ | "å¸‚åœºæ€ä¹ˆæ ·ï¼Ÿ", "å®½åº¦æ˜¯å¤šå°‘ï¼Ÿ" |
| `query_today_signals` | æŸ¥è¯¢ä»Šæ—¥äº¤æ˜“ä¿¡å· | "ä»Šå¤©æœ‰ä»€ä¹ˆè‚¡ç¥¨ï¼Ÿ", "æœ‰è®¢å•å—ï¼Ÿ" |
| `run_system_update` | è¿è¡Œç³»ç»Ÿæ›´æ–° | "æ›´æ–°ç³»ç»Ÿ", "ç”Ÿæˆè®¢å•" |
| `query_backtest_stats` | æŸ¥çœ‹å›æµ‹ç»Ÿè®¡ | "å›æµ‹æ•ˆæœ", "å†å²è¡¨ç°" |
| `get_system_parameters` | æŸ¥çœ‹ç³»ç»Ÿå‚æ•° | "å‚æ•°æ˜¯ä»€ä¹ˆ", "æ€æ ·è°ƒæ•´" |
| `help_command` | æ˜¾ç¤ºå¸®åŠ© | "å¸®åŠ©", "æ€æ ·ä½¿ç”¨" |

---

## ğŸ¯ å¸¸è§é—®é¢˜

### Q1: Agent è¯´"æ²¡æœ‰ç”Ÿæˆè®¢å•"æ€ä¹ˆåŠï¼Ÿ

**åŸå› **: å¯èƒ½æ˜¯ï¼š
1. è¿˜æ²¡æœ‰è¿è¡Œè¿‡ç³»ç»Ÿè„šæœ¬
2. å¸‚åœºæ€åŠ¿ä¸º "Bear"ï¼Œç³»ç»Ÿæ‹’ç»å…¥åœº
3. æ‰€æœ‰ä¿¡å·éƒ½è¢«è¿‡æ»¤æ‰äº†

**è§£å†³**:
```bash
# å…ˆæ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ç³»ç»Ÿ
python3 scripts/run_with_analyse_marketing.py

# ç„¶ååœ¨ Agent ä¸­è¯¢é—®
ğŸ§‘ ä½ : ç°åœ¨æœ‰è®¢å•å—ï¼Ÿ
```

### Q2: å¦‚ä½•ä¿®æ”¹å‚æ•°ï¼Ÿ

ç›®å‰ Agent æä¾›äº†å‚æ•°æŸ¥çœ‹åŠŸèƒ½ã€‚ä¿®æ”¹å‚æ•°éœ€è¦ç¼–è¾‘æºä»£ç ï¼š

**ä¿®æ”¹åŠ¨é‡é˜ˆå€¼** (src/signals.py, ç¬¬135è¡Œ):
```python
entries = (ma5 > ma20) & (q_mom > 0.5) & ...  # æ”¹æˆ 0.5
```

**ä¿®æ”¹ Top-K** (scripts/run_with_analyse_marketing.py, ç¬¬152è¡Œ):
```python
mask_top = score.apply(lambda s: s.rank(ascending=False) <= 30, axis=1)  # æ”¹æˆ 30
```

ä¸‹ä¸€ä¸ªç‰ˆæœ¬ä¼šæ”¯æŒé€šè¿‡ Agent ç›´æ¥è°ƒæ•´å‚æ•°ï¼

### Q3: å¦‚ä½•é™ä½æˆæœ¬ï¼Ÿ

**æ–¹æ¡ˆ**:
1. **æ”¹ç”¨ GPT-3.5-turbo**: å·²é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨
2. **é™ä½è°ƒç”¨é¢‘ç‡**: ä¸éœ€è¦æ¯æ¬¡éƒ½æŸ¥è¯¢ï¼Œç§¯ç´¯é—®é¢˜åä¸€èµ·é—®
3. **ä½¿ç”¨å›½å†…ä»£ç†**: ç¼–è¾‘ `.env` æ·»åŠ  `OPENAI_API_BASE=https://api.openai-proxy.com/v1`

**è´¹ç”¨ä¼°ç®—**:
- GPT-3.5-turbo: å¹³å‡æ¯æ¬¡å¯¹è¯ $0.001-0.005
- æ¯æœˆ 100 æ¬¡å¯¹è¯: ~$0.5-2.5
- **å»ºè®®**: å……å€¼ $10ï¼Œå¯ä»¥ç”¨ 2-3 å¹´

### Q4: æ”¯æŒç¦»çº¿ä½¿ç”¨å—ï¼Ÿ

**ä¸æ”¯æŒ**ã€‚Agent éœ€è¦ OpenAI API è¿æ¥ã€‚ä½†ä½ å¯ä»¥ï¼š
- ä½¿ç”¨æœ¬åœ°å¼€æºå¤§æ¨¡å‹ (LLaMA, Mistral)
- é›†æˆåˆ°å…¬å¸å†…ç½‘çš„å¤§æ¨¡å‹æœåŠ¡
- å‚è€ƒä»£ç è‡ªå·±æ”¹é€ 

### Q5: èƒ½è‡ªåŠ¨ä¸‹å•å—ï¼Ÿ

ç›®å‰ **ä¸èƒ½**ã€‚ç³»ç»Ÿåªç”Ÿæˆè®¢å•å»ºè®®ï¼Œéœ€è¦ç”¨æˆ·åœ¨äº¤æ˜“è½¯ä»¶ä¸­æ‰‹åŠ¨ä¸‹å•ã€‚

**åç»­è§„åˆ’**:
- é›†æˆ TT/CTP API
- å®ç°è‡ªåŠ¨ä¸‹å•åŠŸèƒ½
- æ”¯æŒé£é™©ç®¡ç†å’Œæ­¢æŸ

---

## ğŸ”§ é«˜çº§é…ç½®

### ä½¿ç”¨ GPT-4ï¼ˆæ›´èªæ˜ä½†æ›´è´µï¼‰

ç¼–è¾‘ `agents/trading_agent.py` ç¬¬ 215 è¡Œï¼š

```python
llm = OpenAI(
    temperature=0.3,
    max_tokens=2000,
    model="gpt-4"  # æ”¹æˆ gpt-4
)
```

### ä½¿ç”¨å›½å†…ä»£ç†

ç¼–è¾‘ `.env` æ·»åŠ ï¼š
```
OPENAI_API_BASE=https://api.openai-proxy.com/v1
```

æ”¯æŒçš„ä»£ç†å•†ï¼š
- https://api.openai-proxy.com/v1 (ç¨³å®š)
- https://api.ai3.top/v1
- https://api.fastgpt.in/v1

### ä¿®æ”¹æ¨¡å‹æ¸©åº¦

ç¼–è¾‘ `agents/trading_agent.py` ç¬¬ 214 è¡Œï¼š

```python
llm = OpenAI(
    temperature=0.5,  # æ”¹æˆ 0.5 (0-1ï¼Œæ›´é«˜æ›´åˆ›æ„)
    max_tokens=2000,
    model="gpt-3.5-turbo"
)
```

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„å›¾

```
ç”¨æˆ·è¾“å…¥
   â†“
LangChain Router
   â”œâ”€ ZERO_SHOT_REACT æ¨ç†å¼•æ“
   â”œâ”€ æ€è€ƒ (Thought)
   â”œâ”€ è¡ŒåŠ¨ (Action) â†’ é€‰æ‹©å·¥å…·
   â”œâ”€ è§‚å¯Ÿ (Observation) â†’ å·¥å…·è¿”å›
   â””â”€ æœ€ç»ˆç­”æ¡ˆ (Final Answer)
   â†“
6ä¸ªå·¥å…·å‡½æ•°
   â”œâ”€ query_market_breadth() â†’ å¸‚åœºæ•°æ®
   â”œâ”€ query_today_signals() â†’ äº¤æ˜“è®¢å•
   â”œâ”€ run_system_update() â†’ ç³»ç»Ÿæ›´æ–°
   â”œâ”€ query_backtest_stats() â†’ å›æµ‹æ•°æ®
   â”œâ”€ get_system_parameters() â†’ å‚æ•°æŸ¥è¯¢
   â””â”€ help_command() â†’ å¸®åŠ©ä¿¡æ¯
   â†“
LLM (GPT-3.5-turbo)
   â†“
è‡ªç„¶è¯­è¨€å›å¤ (ä¸­æ–‡)
   â†“
ç”¨æˆ·
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### é˜¶æ®µ 2 (æœ¬æœˆ): å‚æ•°è‡ªåŠ¨è°ƒæ•´
- [ ] Agent æ”¯æŒ"è°ƒæ•´åŠ¨é‡é˜ˆå€¼ä¸º 0.5"
- [ ] è‡ªåŠ¨é‡æ–°è¿è¡Œç³»ç»Ÿ
- [ ] å¯¹æ¯”æ–°æ—§å‚æ•°çš„æ•ˆæœ

### é˜¶æ®µ 3 (ä¸‹æœˆ): å¤šè½®å¯¹è¯è®°å¿†
- [ ] Agent è®°ä½å†å²å¯¹è¯
- [ ] æ”¯æŒ"åŸºäºä¸Šæ¬¡çš„ç»“æœï¼Œè¯•è¯•æ›´æ¿€è¿›çš„ç­–ç•¥"
- [ ] ä¿å­˜å¯¹è¯æ—¥å¿—

### é˜¶æ®µ 4 (æœªæ¥): é›†æˆå…¶ä»– AI èƒ½åŠ›
- [ ] æƒ…ç»ªåˆ†æ (æ–°é—»çˆ¬è™« + BERT)
- [ ] å¼ºåŒ–å­¦ä¹ å‚æ•°ä¼˜åŒ–
- [ ] å›¾è¡¨è¯†åˆ«å’Œåˆ†æ

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

æœ‰é—®é¢˜ï¼Ÿ

1. æŸ¥çœ‹ `.env.example` ç¡®è®¤é…ç½®
2. ç¡®ä¿ `analyse_marketing` æœ‰æœ€æ–°æ•°æ®
3. æ£€æŸ¥ Python ç‰ˆæœ¬ >= 3.8
4. æŸ¥çœ‹ Agent çš„è¯¦ç»†æ—¥å¿—ï¼ˆè¾“å‡ºçª—å£ä¼šæ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹ï¼‰

---

## ğŸ“ å­¦ä¹ èµ„æº

- [LangChain å®˜æ–¹æ–‡æ¡£](https://python.langchain.com/)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs/api-reference)
- [Agent å·¥ä½œåŸç†](https://python.langchain.com/docs/modules/agents/)

**ç¥ä½ äº¤æ˜“é¡ºåˆ©ï¼** ğŸš€ğŸ“ˆ
